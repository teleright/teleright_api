[TOC]

------



# Общая информация

- Всё API работает по протоколу HTTPS.
- Авторизация осуществляется по протоколу JWT.
- Все данные доступны только в формате JSON.
- Базовый URL — `https://api.teleright.ru/api/v1`




### Требования к запросам

В запросе необходимо передавать заголовок `Authorization` c jwt токеном, в противном случае ответом будет `401 Failed to authenticate because of bad credentials or an invalid authorization header `. Указание в заголовке названия приложения и контактной почты разработчика позволит нам оперативно с вами связаться в случае необходимости.

```
User-Agent: MyApp/1.0 (my-app-feedback@example.com)
```



### Формат тела запроса при отправке JSON

Данные, передающиеся в теле запроса, должны удовлетворять требованиям:

- Валидный JSON (допускается передача как минифицированного варианта, так и pretty print варианта с дополнительными пробелами и сбросами строк).

- Рекомендуется использование кодировки UTF-8 без дополнительного экранирования

  (`{"name": "Иванов Иван"}`).

- Также возможно использовать ascii кодировку с экранированием

  (`{"name": "\u0418\u0432\u0430\u043d\u043e\u0432 \u0418\u0432\u0430\u043d"}`).

- К типам данных в определённым полях накладываются дополнительные условия,описанные в каждом конкретном методе. В JSON типами данных являются `string`,`number`, `boolean`, `null`, `object`, `array`.




### Авторизация пользователя

Полученный токен доступа необходимо передавать в заголовке **Authorization** в формате **Bearer =Token=** в каждом запроса к API. Пример заголовка: 

```
Authorization: Bearer ykX7vsJstZkUh1x3hG5sIeRgRaICMm
```

Запросы к API будут выполняться от имени и с разрешениями пользователя, предоставившего доступ приложению. Если в процессе использования токена возникла ошибка авторизации, рекомендуется запросить токен заново, даже если заявленное в поле **expires_in **время до истечения токена еще не прошло.

Так же возможно делать запросы через GET параметр у каждого доступного метода API.

```
https://api.teleright.ru/api/v1/method?token=ykX7vsJstZkUh1x3hG5sIeRgRaICMm
```



### Ошибки и коды ответов

API широко использует информирование при помощи кодов ответов. Приложение должно корректно их обрабатывать.

При каждой ошибке, помимо кода ответа, в теле ответа может быть выдана дополнительная информация, позволяющая разработчику понять причину соответствующего ответа.

```json
{
"message": "User was updated prior to your request.",
"status_code": 409
}
```


| Общие ошибки сервера                     | Code |
| ---------------------------------------- | ---- |
| Данный пользователь не обладает правом доступа на запрашиваемый ресурс | 403  |
| Неверный форма одного из аргументов, передаваемых в теле запроса, либо отсутствие одного из обязательных аргументов. | 400  |
| Запрос не может быть выполнен из-за конфликтного обращения к ресурсу. | 409  |
| Ресурс раньше был по указанному URL, но был удалён и теперь недоступен. Серверу в этом случае неизвестно и местоположение альтернативного документа). | 410  |
| Критические ошибки ресурса или не        | 500  |
| Для указанного ресурса клиент должен указать Content-Length в заголовке запроса. Без указания этого поля не стоит делать повторную попытку запроса к серверу по данному URI. Такой ответ естественен для запросов типа POST и PUT. | 411  |
| Указанный клиентом метод нельзя применить к текущему ресурсу. | 405  |
| Запрошенный URI не может удовлетворить переданным в заголовке характеристикам. | 406  |
| Сервер понял запрос, но не нашёл соответствующего ресурса по указанному URI. | 404  |
| Ни одно из условных полей заголовка (If-Match и др., см. RFC 7232) запроса не было выполнено. | 412  |
| Сервер указывает клиенту на необходимость использования в запросе заголовков условий, наподобие If-Match. | 428  |
| Сервер временно не имеет возможности обрабатывать запросы по техническим причинам (обслуживание, перегрузка и прочее). В поле Retry-After заголовка сервер может указать время, через которое клиенту рекомендуется повторить запрос. | 503  |
| Клиент попытался отправить слишком много запросов за короткое время. | 429  |
| для доступа к запрашиваемому ресурсу требуется аутентификация. В заголовке ответ должен содержать поле WWW-Authenticate с перечнем условий аутентификации. Клиент может повторить запрос, включив в заголовок сообщения поле Authorization с требуемыми для аутентификации данными. | 401  |
| По каким-то причинам сервер отказывается работать с указанным типом данных при данном методе. | 415  |
| Сервер успешно принял запрос, может работать с указанным видом данных, в теле запроса документ имеет верный синтаксис, но имеется какая-то логическая ошибка, из-за которой невозможно произвести операцию над ресурсом. | 422  |
| Не удается создать токен.                | 500  |



| Метод запроса | Код успешного выполнения |
| ------------- | ------------------------ |
| GET           | 200                      |
| POST          | 200                      |
| PUT           | 200                      |
| DELETE        | 204                      |



### Недокументированные поля и параметры запросов

В ответах и параметрах API можно найти ключи не описанные в документации. Обычно это означает, что они оставлены для совместимости со старыми версиями. Их использование не рекомендуется. Если ваше приложение использует такие ключи, перейдите на использование актуальных ключей, описанных в документации.



### Лимиты на количество запросов

Существуют лимиты на количество API-запросов в час для всех пользователей клиента. В случае, если лимит на количество запросов будет превышен, на запрос вернется ответ с кодом `429 Too Many Requests` и статусом `rate_limit_exceeded`, следующий запрос можно будет осуществить только в следующем часе. Лимит распространятся на пользователей типа "клиент" и является общим для всех пользователей клиента независимо от используемых приложений.

Информация о лимите на количество запросов данного типа, количестве оставшихся запросов до исчерпания лимита и времени до сброса счетчика запросов передается в специальных заголовках.



| Заголовок             | Описание                                 |
| --------------------- | ---------------------------------------- |
| X-RateLimit-Limit     | Лимит на количество запросов в час на данный ресурс |
| X-RateLimit-Remaining | Количестве оставшихся запросов до исчерпания лимита |
| X-RateLimit-Reset     | Количество секунд до сброса счётчика запросов |

```http
server: nginx
date: Fri, 25 Nov 2016 10:26:49 GMT
content-type: application/json
content-length: 66
connection: keep-alive
keep-alive: timeout=60
x-powered-by: PHP/5.6.23
x-ratelimit-limit: 60
x-ratelimit-remaining: 0
x-ratelimit-reset: 1480069627
retry-after: 18
cache-control: no-cache
```



### CORS (Cross-Origin Resource Sharing)

API поддерживает технологию CORS для запроса данных из браузера с произвольного домена. Этот метод более предпочтителен, чем использование JSONP. Он не ограничен методом GET.

- [CORS specification on w3.org](http://www.w3.org/TR/cors/)
- [HTML5Rocks CORS Tutorial](http://www.html5rocks.com/en/tutorials/cors/)
- [CORS on dev.opera.com](http://dev.opera.com/articles/view/dom-access-control-using-cross-origin-resource-sharing/)
- [CORS on caniuse.com](http://caniuse.com/#feat=cors)
- [CORS on en.wikipedia.org](http://en.wikipedia.org/wiki/Cross-origin_resource_sharing)



### Интерактивный обозреватель API

Для удобного просмотра и тестирования ресурсов REST API существует интерактивный обозреватель API, который располагается по адресу [http://api.teleright.ru/api/docs/](http://api.teleright.ru/api/docs/)

Обозреватель API представляет собой интерактивную страницу, где представлены все доступные ресурсы REST API, их методы, а также входные параметры и поля ответа методов.

Для осуществления запросов к API через интерактивный обозреватель необходимо зарегистрироваться в личном кабинете и произвести авторизацию. После этого все методы будут доступны для использования.